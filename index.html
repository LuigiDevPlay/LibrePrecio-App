<!doctype html>
<html lang="es" id="mainHtml">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=pub-3519027820107797"
      crossorigin="anonymous"
    ></script>
    <title>LibrePrecio | Calculadora App</title>
    <link rel="stylesheet" href="src/css/styles.css" />

    <script>
      // Cambiamos la l√≥gica: Si no hay nada guardado, por defecto NO pone 'dark'
      if (!localStorage.getItem("theme") === "dark") {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>

    <style>
      /* Asegura que los placeholders sean visibles */
      input::placeholder,
      textarea::placeholder {
        color: #94a3b8 !important; /* Un gris Slate-400 claro */
        opacity: 1 !important;
      }

      .dark input::placeholder {
        color: #64748b !important; /* Un gris Slate-500 para el modo oscuro */
      }
      /* --- ESTILOS PARA LA VISTA EN PANTALLA (WEB) --- */
      #contenedorTablaPdf.split {
        column-count: 1 !important;
      }

      #contenedorTablaPdf tr {
        border-left: 4px solid #3b82f6;
        margin-bottom: 2px;
      }

      #alertaInflacion span {
        text-decoration: underline;
        text-decoration-color: currentColor;
        text-underline-offset: 2px;
      }

      /* --- ESTILOS EXCLUSIVOS PARA IMPRESI√ìN (PDF) --- */
      @media print {
        .no-print {
          display: none !important;
        }
        body {
          background: white !important;
          padding: 0 !important;
          margin: 0 !important;
        }
        @page {
          size: portrait;
          margin: 5mm;
        }

        .bg-blue-600 {
          background-color: #2563eb !important;
          -webkit-print-color-adjust: exact;
        }
        .text-white {
          color: white !important;
        }
        .rotate-12 {
          transform: rotate(12deg) !important;
        }
        .-rotate-12 {
          transform: rotate(-12deg) !important;
        }

        #informe {
          display: block !important;
          padding: 10px !important;
          width: 100% !important;
          border: none !important;
          color: black !important;
        }

        #contenedorTablaPdf.split {
          display: block !important;
          column-count: 2 !important;
          column-gap: 20px !important;
          column-rule: 1px solid #e2e8f0;
        }

        #contenedorTablaPdf.split .tabla-borde {
          border: none !important;
        }

        #contenedorTablaPdf table {
          width: 100% !important;
          font-size: 8.5px !important;
        }

        #contenedorTablaPdf tr {
          break-inside: avoid !important;
          border-left: 3px solid #3b82f6 !important;
        }

        #pdfListaItems tr:nth-child(even) {
          background-color: #f8fafc !important;
        }

        .split tfoot {
          display: none !important;
        }

        .logo_pdf {
          background: #000;
        }
      }
      @media screen {
        #pdfSugerenciaContenedor {
          display: none !important;
        }
      }
    </style>
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300 font-sans"
  >
    <div class="max-w-4xl mx-auto py-10 px-4">
      <header class="flex justify-between items-center mb-8 no-print">
        <div>
          <h1 class="text-4xl font-black text-blue-600 dark:text-blue-400 tracking-tighter">
            LibrePrecio
          </h1>
          <p class="text-xs text-gray-500 font-bold uppercase tracking-widest">
            Calculadora de Presupuestos
          </p>
        </div>
        <button
          onclick="toggleDarkMode()"
          class="p-3 bg-white dark:bg-gray-800 shadow-md rounded-full"
        >
          <span id="themeIcon">üåô</span>
        </button>
      </header>

      <div class="flex bg-gray-200 dark:bg-gray-800 p-1 rounded-2xl mb-8 no-print shadow-inner">
        <button
          onclick="cambiarModo('producto')"
          id="btnModoProducto"
          class="flex-1 py-3 rounded-xl font-bold transition-all bg-white dark:bg-blue-600 shadow text-blue-600 dark:text-white text-sm md:text-base"
        >
          üì¶ Producto
        </button>
        <button
          onclick="cambiarModo('servicio')"
          id="btnModoServicio"
          class="flex-1 py-3 rounded-xl font-bold transition-all text-gray-500 dark:text-gray-400 text-sm md:text-base"
        >
          üõ†Ô∏è Servicio
        </button>
      </div>

      <section
        class="no-print bg-blue-50 dark:bg-gray-800 p-6 rounded-3xl mb-6 border-2 border-dashed border-blue-200"
      >
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input
            type="text"
            id="inputNegocio"
            placeholder="Nombre de tu Negocio"
            class="p-3 rounded-xl border dark:bg-gray-700 outline-none"
          />
          <input
            type="text"
            id="inputLogo"
            maxlength="2"
            placeholder="Iniciales Logo (Ej: LP)"
            class="p-3 rounded-xl border dark:bg-gray-700 outline-none"
          />
        </div>
      </section>

      <section
        id="seccionProducto"
        class="no-print bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-6 mb-6 border border-gray-100 dark:border-gray-700 animate-fade"
      >
        <h2 class="text-xl font-bold mb-6 text-blue-500 italic">üì¶ Materia Prima e Insumos</h2>
        <div id="listaInsumos" class="space-y-3 mb-6">
          <div
            class="grid grid-cols-12 gap-2 items-center bg-gray-50 dark:bg-gray-900/50 p-3 rounded-xl border dark:border-gray-700 shadow-sm"
          >
            <div class="col-span-10 md:col-span-4">
              <label class="block text-[8px] md:text-[10px] uppercase text-gray-400 font-bold mb-1"
                >Insumo / Concepto</label
              >
              <input
                type="text"
                placeholder="Insumo (ej. Harina)"
                class="w-full p-2 bg-transparent outline-none text-xs md:text-sm font-medium dark:text-white"
              />
            </div>

            <button
              onclick="this.parentElement.remove()"
              class="col-span-2 md:col-span-1 text-red-400 text-2xl hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors md:order-last self-end pb-1"
            >
              √ó
            </button>

            <div class="col-span-4 md:col-span-2">
              <label
                class="block text-[8px] md:text-[10px] uppercase text-gray-400 font-bold mb-1 text-center md:text-left"
              >
                <span class="md:hidden">Cant.</span>
                <span class="hidden md:inline">Cantidad</span>
              </label>
              <input
                type="number"
                placeholder="0"
                oninput="actualizarSubtotal(this)"
                class="w-full p-2 bg-white dark:bg-gray-700 border dark:border-gray-600 rounded-lg text-center item-cant text-xs md:text-sm dark:text-white"
              />
            </div>

            <div class="col-span-4 md:col-span-2">
              <label
                class="block text-[8px] md:text-[10px] uppercase text-gray-400 font-bold mb-1 text-center md:text-left"
              >
                <span class="md:hidden">Precio</span>
                <span class="hidden md:inline">Precio Product.</span>
              </label>
              <input
                type="number"
                placeholder="0.00"
                oninput="actualizarSubtotal(this)"
                class="w-full p-2 bg-white dark:bg-gray-700 border dark:border-gray-600 rounded-lg text-center item-precio text-xs md:text-sm dark:text-white"
              />
            </div>

            <div class="col-span-4 md:col-span-3">
              <label
                class="block text-[8px] md:text-[10px] uppercase text-gray-400 font-bold mb-1 text-right"
              >
                <span class="md:hidden">Total</span>
                <span class="hidden md:inline">Total</span>
              </label>
              <input
                type="text"
                value="0.00"
                class="w-full p-2 text-right font-black item-subtotal text-blue-600 dark:text-blue-400 text-xs md:text-sm bg-blue-50/50 dark:bg-blue-900/20 border border-blue-400 dark:border-blue-800 rounded-lg"
                readonly
              />
            </div>
          </div>
        </div>
        <div class="flex justify-between items-center">
          <button
            onclick="agregarFila()"
            class="bg-blue-50 dark:bg-blue-900/30 text-blue-600 px-6 py-2.5 rounded-xl font-bold"
          >
            + Insumo
          </button>
          <div class="flex items-center gap-3 bg-blue-600 p-3 rounded-2xl">
            <label class="text-[10px] font-black uppercase text-blue-100">Producci√≥n:</label>
            <input
              type="number"
              id="unidadesProduccion"
              value="1"
              min="1"
              class="w-12 bg-white rounded-lg text-center font-black text-blue-600 p-1"
            />
          </div>
        </div>
      </section>

      <section
        id="seccionServicio"
        class="hidden no-print bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-6 mb-6 border border-gray-100 dark:border-gray-700 animate-fade"
      >
        <h2 class="text-xl font-bold mb-6 text-purple-500 italic">üõ†Ô∏è Presupuesto de Servicio</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <input
            type="number"
            id="precioHora"
            placeholder="Costo por hora ($)"
            class="p-3 border rounded-xl dark:bg-gray-700 font-bold"
          />
          <input
            type="number"
            id="horasProyecto"
            placeholder="Horas por proyecto"
            class="p-3 border rounded-xl dark:bg-gray-700 font-bold"
          />
          <input
            type="number"
            id="proyectosMes"
            placeholder="Proyectos al mes"
            class="p-3 border border-purple-300 rounded-xl dark:bg-gray-700 font-bold text-purple-600"
          />
          <select
            id="modalidadServicio"
            onchange="toggleTransporte()"
            class="p-3 border rounded-xl dark:bg-gray-700 font-bold"
          >
            <option value="digital">üíª Digital</option>
            <option value="presencial">üöó Presencial</option>
          </select>
          <div id="divTransporte" class="hidden md:col-span-2">
            <input
              type="number"
              id="gastoTransporte"
              placeholder="Gastos Traslado ($)"
              class="w-full p-3 border border-orange-300 rounded-xl dark:bg-gray-700 font-bold text-orange-600"
            />
          </div>
        </div>
      </section>

      <section
        class="no-print bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-6 mb-6 border border-gray-100 dark:border-gray-700"
      >
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-6">
          <div>
            <label class="text-[10px] uppercase font-black text-gray-400">Luz ($)</label>
            <input
              type="number"
              id="luz"
              value="0"
              class="w-full p-3 border rounded-xl dark:bg-gray-700 dark:text-white"
            />
          </div>
          <div>
            <label class="text-[10px] uppercase font-black text-gray-400">Agua ($)</label>
            <input
              type="number"
              id="agua"
              value="0"
              class="w-full p-3 border rounded-xl dark:bg-gray-700 dark:text-white"
            />
          </div>
          <div>
            <label class="text-[10px] uppercase font-black text-gray-400">Internet ($)</label>
            <input
              type="number"
              id="internet"
              value="0"
              class="w-full p-3 border rounded-xl dark:bg-gray-700 dark:text-white"
            />
          </div>
          <div>
            <label class="text-[10px] uppercase font-black text-gray-400">Tel√©fono ($)</label>
            <input
              type="number"
              id="telefono"
              value="0"
              class="w-full p-3 border rounded-xl dark:bg-gray-700 dark:text-white"
            />
          </div>
          <div id="contenedorTransporte">
            <label class="text-[10px] uppercase font-black text-gray-400">Transporte ($)</label>
            <input
              type="number"
              id="transporteGlobal"
              value="0"
              class="w-full p-3 border rounded-xl dark:bg-gray-700 dark:text-white"
            />
          </div>
          <div>
            <label class="text-[10px] uppercase font-black text-green-500">% Margen</label>
            <input
              type="number"
              id="ganancia"
              value="30"
              class="w-full p-3 border rounded-xl dark:bg-gray-700 text-green-500 font-bold"
            />
          </div>
          <div>
            <label class="text-[10px] uppercase font-black text-red-500">% Inflaci√≥n</label>
            <input
              type="number"
              id="inflacion"
              value="5"
              class="w-full p-3 border rounded-xl dark:bg-gray-700 text-red-500 font-bold"
            />
          </div>
        </div>

        <div
          class="mb-8 p-4 bg-gray-50 dark:bg-gray-900/30 rounded-2xl border dark:border-gray-800"
        >
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <input
                type="checkbox"
                id="checkAdicionales"
                class="w-5 h-5 accent-blue-600"
                onchange="
                  document
                    .getElementById('contenedorAdicionales')
                    .classList.toggle('hidden', !this.checked)
                "
              />
              <label
                for="checkAdicionales"
                class="font-black text-sm uppercase tracking-tighter dark:text-white"
                >¬øIncluir Gastos Adicionales? (Gas, Publicidad, etc.)</label
              >
            </div>
            <button
              onclick="agregarFilaAdicional()"
              class="text-blue-500 font-bold text-xs uppercase"
            >
              + A√±adir Gasto
            </button>
          </div>

          <div id="contenedorAdicionales" class="hidden space-y-3">
            <div id="listaAdicionales" class="space-y-3"></div>
          </div>
        </div>

        <div class="flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-900 rounded-2xl mb-6">
          <input type="checkbox" id="checkTerminos" class="w-5 h-5 accent-blue-600" />
          <label for="checkTerminos" class="text-xs text-gray-500 italic"
            >Acepto los t√©rminos y el procesamiento de datos del informe.</label
          >
        </div>

        <button
          onclick="iniciarProceso()"
          id="btnCalcular"
          class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-lg uppercase tracking-widest hover:bg-blue-700 transition"
        >
          Calcular Informe
        </button>
        <div
          class="no-print mt-6 p-4 bg-orange-50 dark:bg-orange-900/10 rounded-2xl border border-orange-100 dark:border-orange-800/30 text-center transition-all hover:shadow-sm"
        >
          <p
            class="text-[11px] text-orange-800 dark:text-orange-300 font-black uppercase tracking-widest flex items-center justify-center gap-2"
          >
            ‚òï ¬øTe ayud√≥ la herramienta?
          </p>
          <p class="text-[10px] text-orange-600 dark:text-orange-400/80 mt-1 italic">
            Tu apoyo me ayuda a mantener este proyecto libre de suscripciones.
          </p>
          <div
            class="mt-2 font-black text-xs text-orange-700 dark:text-orange-200 bg-white dark:bg-orange-800/40 py-2 px-4 rounded-lg inline-block border border-orange-200 dark:border-orange-700"
          >
            PayPal: <span class="select-all">lm3771843@gmail.com</span>
          </div>
        </div>
      </section>

      <div id="resultado" class="hidden animate-fade space-y-6">
        <div
          id="informe"
          class="informe-layout p-6 md:p-10 bg-white dark:bg-gray-900 rounded-[30px] border-2 border-blue-100 dark:border-gray-800 shadow-2xl relative overflow-hidden text-black dark:text-white"
        >
          <div class="flex justify-between items-start mb-6 border-b-2 border-blue-600 pb-4">
            <div class="flex items-center gap-4">
              <div
                style="-webkit-print-color-adjust: exact; print-color-adjust: exact"
                class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center rotate-12 shadow-lg print:rotate-12"
              >
                <span
                  id="pdfLogoTexto"
                  class="text-white font-black text-xl -rotate-12 print:-rotate-12"
                >
                  $
                </span>
              </div>

              <div>
                <h2
                  id="pdfNombreNegocio"
                  class="text-xl font-black text-gray-800 uppercase tracking-tighter leading-none mb-1"
                >
                  TU NEGOCIO
                </h2>
                <p class="text-[10px] text-gray-400 font-medium tracking-widest uppercase">
                  Generado por <span class="text-blue-600 font-bold">LibrePrecio</span>
                </p>
              </div>
            </div>

            <div class="text-right">
              <p id="pdfFecha" class="text-xs font-black text-gray-800"></p>
              <p
                id="subtituloInforme"
                class="text-[9px] bg-blue-100 text-blue-700 px-2 py-1 rounded-md font-bold uppercase tracking-tighter mt-1 inline-block"
              ></p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="p-4 bg-green-500 text-white rounded-2xl text-center shadow-md">
              <p id="labelPrincipal" class="text-[9px] uppercase font-bold opacity-90">
                Precio Sugerido
              </p>
              <p id="resPrincipal" class="text-2xl font-black">$0.00</p>
            </div>
            <div class="p-4 bg-blue-600 text-white rounded-2xl text-center shadow-md">
              <p id="labelSecundario" class="text-[9px] uppercase font-bold opacity-90">
                Sugerido Mayor
              </p>
              <p id="resSecundario" class="text-2xl font-black">$0.00</p>
            </div>
          </div>

          <div class="mb-4">
            <h4 class="font-black text-blue-600 uppercase text-[9px] mb-2 tracking-widest">
              Detalle de Inversi√≥n
            </h4>
            <div id="contenedorTablaPdf">
              <div class="tabla-borde border dark:border-gray-700 rounded-2xl overflow-hidden">
                <table class="w-full text-left text-sm">
                  <thead class="bg-gray-50 dark:bg-gray-800">
                    <tr>
                      <th class="p-2 font-black text-gray-400 uppercase text-[9px]">#</th>
                      <th class="p-2 font-black text-gray-400 uppercase text-[9px]">Descripci√≥n</th>
                      <th class="p-2 text-center font-black text-gray-400 uppercase text-[9px]">
                        Cant.
                      </th>
                      <th class="p-2 text-center font-black text-gray-400 uppercase text-[9px]">
                        Precio
                      </th>
                      <th class="p-2 text-right font-black text-gray-400 uppercase text-[9px]">
                        Total
                      </th>
                    </tr>
                  </thead>
                  <tbody id="pdfListaItems"></tbody>
                  <tfoot id="pdfPieTabla" class="bg-blue-50 dark:bg-blue-900/20 font-black">
                    <tr>
                      <td colspan="4" class="p-2 text-right text-blue-600 uppercase text-[10px]">
                        Total Inversi√≥n:
                      </td>
                      <td
                        id="pdfTotalInversion"
                        class="p-2 text-right text-blue-700 dark:text-blue-400 text-[10px]"
                      ></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>

          <div id="contenedorResumenFinal" class="hidden grid grid-cols-2 gap-4 mb-8">
            <div
              class="p-4 bg-gray-50 dark:bg-gray-800 rounded-2xl border dark:border-gray-700 text-center"
            >
              <p class="text-[10px] uppercase font-bold text-gray-400">Unidades Totales</p>
              <p id="pdfCantFinal" class="text-xl font-black"></p>
            </div>
            <div
              class="p-4 bg-gray-50 dark:bg-gray-800 rounded-2xl border dark:border-gray-700 text-center"
            >
              <p class="text-[10px] uppercase font-bold text-gray-400">Costo de Inversi√≥n</p>
              <p id="pdfPrecioTotalFinal" class="text-xl font-black text-green-600"></p>
            </div>
          </div>

          <div class="bg-gray-50 dark:bg-gray-800/50 p-6 rounded-3xl border dark:border-gray-700">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
              <div>
                <p id="labelCol1" class="text-gray-400 text-[10px] uppercase font-bold"></p>
                <p id="resCol1" class="text-lg font-bold"></p>
              </div>
              <div>
                <p id="labelCol2" class="text-gray-400 text-[10px] uppercase font-bold"></p>
                <p id="resCol2" class="text-lg font-bold"></p>
              </div>
              <div>
                <p id="labelCol3" class="text-gray-400 text-[10px] uppercase font-bold"></p>
                <p id="resCol3" class="text-lg font-bold"></p>
              </div>
              <div>
                <p id="labelCol4" class="text-gray-400 text-[10px] uppercase font-bold"></p>
                <p id="resCol4" class="text-lg font-bold text-blue-600"></p>
              </div>
            </div>
          </div>

          <div id="alertaInflacion" class="mt-4 text-center"></div>

          <div
            id="pdfSugerenciaContenedor"
            class="hidden mt-4 p-3 border-l-4 border-blue-500 bg-blue-50/50 rounded-r-xl no-web-view"
          >
            <p class="text-[9px] font-black text-blue-800 uppercase tracking-widest mb-1">
              Nota de Rentabilidad:
            </p>
            <p id="pdfSugerenciaTexto" class="text-[10px] text-gray-700 leading-tight italic"></p>
          </div>
        </div>

        <button
          onclick="window.print()"
          class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-black no-print transition-all shadow-lg active:scale-95"
        >
          üñ®Ô∏è GENERAR PDF PROFESIONAL
        </button>

        <div class="no-print bg-yellow-50 border border-yellow-200 p-4 rounded-xl text-center mt-6">
          <p class="text-xs text-yellow-800 font-medium">
            üåü <strong>Apoya este proyecto:</strong> Si esta calculadora te ayud√≥...
          </p>
          <div class="mt-2 text-[10px] font-black text-yellow-600 space-y-1">
            <p class="break-all">USDT: TQ4v1n1WU8iHRnCAMEkTsRea8DK9j949mm</p>
            <p>PayPal: lm3771843@gmail.com</p>
          </div>
        </div>
      </div>

      <footer
        class="mt-20 no-print border-t border-gray-200 dark:border-gray-800 pt-10 pb-10 text-center"
      >
        <p class="text-xs text-gray-400 mb-4">
          ¬© 2024 LibrePrecio. Herramienta gratuita para emprendedores.
        </p>
        <div
          class="flex justify-center gap-6 text-[10px] font-bold text-blue-500 uppercase tracking-widest"
        >
          <a href="privacidad.html" class="hover:underline">Privacidad</a>
          <a href="terminos.html" class="hover:underline">T√©rminos de Uso</a>
          <a href="contacto.html" class="hover:underline">Contacto</a>
        </div>
      </footer>

      <div
        id="modalCarga"
        class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4"
      >
        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl max-w-sm w-full text-center">
          <div class="text-4xl mb-4">üõ°Ô∏è</div>
          <h3 class="text-xl font-black mb-2 dark:text-white">Verificando Datos...</h3>
          <div class="w-full bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden">
            <div
              id="barraCarga"
              class="bg-blue-600 h-full transition-all duration-300"
              style="width: 0%"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="modalTerminos"
      class="hidden fixed inset-0 bg-black/60 backdrop-blur-md z-100 flex items-center justify-center p-4 animate-fade"
    >
      <div
        class="bg-white dark:bg-gray-800 w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl border border-red-100 dark:border-red-900/30"
      >
        <div
          class="w-16 h-16 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl"
        >
          ‚ö†Ô∏è
        </div>
        <h3 class="text-xl font-black text-gray-900 dark:text-white uppercase tracking-tighter">
          Acceso Denegado
        </h3>
        <p class="text-gray-500 dark:text-gray-400 text-sm mt-3 leading-relaxed">
          Para garantizar la seguridad legal y financiera, es obligatorio aceptar los
          <b>T√©rminos de Uso y Pol√≠ticas</b> antes de generar el informe.
        </p>
        <button
          onclick="document.getElementById('modalTerminos').classList.add('hidden')"
          class="mt-8 w-full bg-gray-900 dark:bg-white dark:text-gray-900 text-white font-bold py-4 rounded-2xl hover:scale-105 transition-transform"
        >
          Entendido, lo har√©
        </button>
      </div>
    </div>

    <script src="src/js/main.js"></script>
  </body>
</html>
